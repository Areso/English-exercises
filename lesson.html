<!DOCTYPE html>
<head>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>English exercises</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(91922670, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<!-- /Yandex.Metrika counter -->
<script src="js/eventer.js" ></script>
</head>
<body class="interactive-page">
    <noscript>
      <div>
        <img src="https://mc.yandex.ru/watch/91922670" style="position:absolute; left:-9999px;" alt=""/>
      </div>
    </noscript>

    <div class="container">
      <div class="exercise-header">
        <h2 id="spnTopic">Put the correct preposition!</h2>
        <div class="progress">
          <span id="spnCurPos">1</span>/<span id="spnTotal">N</span>
        </div>
      </div>
      <div class="question-card" id="question">
        <!-- Question would be put here -->
      </div>

      <!-- Grid with the options -->
      <div class="answer-options" id="answer_radiobutton_div">
        <!-- Dynamically filled -->
      </div>

      <div id="answer_text_div">
        <input type="text" id="answer_text_field" placeholder="Type your answer here">
      </div>

      <div class="result-section" id="resultDiv">
        <span id="lblAction">CHECK:</span>
        <span id="resultLbl"></span>
      </div>

      <div class="button-group">
        <button id="checkBtn" class="preferred" onclick="getAnswer()" tabindex="0">Check Answer</button>
        <button id="nextBtn" onclick="nextCard()" tabindex="0">Skip Card</button>
        <button id="showAnswerBtn" onclick="showAnswer()" tabindex="0">Show Answer</button>
      </div>

      <dialog id="kbdTipDialog" aria-labelledby="kbdTipTitle" aria-describedby="kbdTipDesc">
        <h3 id="kbdTipTitle">Keyboard navigation</h3>
        <p id="kbdTipDesc">
          Use <b>Left/Right</b> arrows to switch answers.<br>
          Backspace to press the button.<br>
        </p>
        <!-- method="dialog" makes the button close the dialog automatically -->
        <form method="dialog">
          <button id="kbdTipClose" type="submit">Got it</button>
        </form>
      </dialog>
      <div class="back-link">
        <a href="index.html">Back to the table of content</a>
      </div>
    </div>

    <script>
      include = function (url, fn) {
        var e = document.createElement("script");
        e.onload = fn;
        e.src = url;
        e.async = true;
        document.getElementsByTagName("head")[0].appendChild(e);
      };
    </script>
    <script id="lessonDeckScript"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const lesson_name = urlParams.get('lesson');
      const lesson_src = "decks/" + lesson_name + ".js";
      document.getElementById("lessonDeckScript").src = lesson_src;
    </script>

    <script>
      // for debug: localStorage.removeItem("seen_keyboard_tip");
      const dlg = document.getElementById("kbdTipDialog");
      // Close dialog when clicking on the backdrop
      dlg.addEventListener("click", (event) => {
        // The dialog box itself is the target. 
        // If we click inside the 'rect' of the dialog, we do nothing.
        // If we click outside (on the ::backdrop), we close it.
        const rect = dlg.getBoundingClientRect();
        const isInDialog = (rect.top <= event.clientY && event.clientY <= rect.top + rect.height &&
          rect.left <= event.clientX && event.clientX <= rect.left + rect.width);

        if (!isInDialog) {
          dlg.close();
        }
      });

      if (!localStorage.getItem("seen_keyboard_tip")) {
        window.addEventListener("keydown", (e) => {
          if (e.key === "Tab") {
            localStorage.setItem("seen_keyboard_tip", "1");
            showTipOnce();
          }
        }, 
        { capture: true, once: true });
      } else {
        console.log("the tip was shown already");
      }
      function showTipOnce() {
        // showModal gives you a real modal (focus trap + backdrop)
        if (typeof dlg.showModal === "function") dlg.showModal();
        else dlg.setAttribute("open", ""); // fallback
      }
    </script>
</body>
</html>
